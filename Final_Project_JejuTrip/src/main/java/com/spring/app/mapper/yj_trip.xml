<?xml version="1.0" encoding="UTF-8"?>

<!-- ==== #29. mapper 기본설정 ==== -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- ==== #29. 루트 엘리먼트 & 네임스페이스 설정(네임스페이스명은 프로젝트 전체내에서 유일해야 한다!!!!!) ====  절대  ; 쓰지마라 !!!!!!!!!! 
메퍼가 바뀌면 무조건  WAS를 껐다 켜야한다!!!!!!!!! -->
<mapper namespace="yj_trip">


	<!-- 맛집 카테고리 띄우기 -->
	<select id="categoryList" resultType="String">
		select distinct food_category
		from tbl_food_store
	</select>


	<!-- 지역 선택  -->
	<select id="areaList" resultType="String">
		select distinct local_status
		from tbl_food_store
		order by local_status
	</select>


	<!-- 맛집 리스트 띄우기 -->
	<resultMap type="HashMap" id="categoryMap">
		<result property="food_store_code" 		column="food_store_code" 	javaType="String" />	
		<result property="local_status" 		column="local_status" 		javaType="String" />	
		<result property="food_name" 			column="food_name" 			javaType="String" />	
		<result property="food_content" 		column="food_content" 		javaType="String" />	
		<result property="food_businesshours" 	column="food_businesshours" javaType="String" />	
		<result property="food_mobile" 			column="food_mobile" 		javaType="String" />	
		<result property="food_address" 		column="food_address" 		javaType="String" />	
		<result property="food_main_img" 		column="food_main_img" 		javaType="String" />	
		<result property="review_division" 		column="review_division" 	javaType="String" />	
		<result property="food_category" 		column="food_category" 		javaType="String" />	

		<result property="food_category" 		column="food_category" 		javaType="String" />	
		<result property="food_category" 		column="food_category" 		javaType="String" />	
		<result property="food_category" 		column="food_category" 		javaType="String" />	
	</resultMap>
	<select id="viewFoodstoreList" parameterType="HashMap" resultMap="categoryMap">
		SELECT food_store_code, local_status, food_name, food_content, food_businesshours, food_mobile
			 , substr(food_address, 0, instr(food_address, ' ', 1, 2)-1) AS food_address
			 , food_main_img, review_division
			 , food_category
		FROM tbl_food_store
		WHERE 1=1
		<if test="arr_category != null">
			AND food_category IN
			<foreach collection="arr_category" index="i" open="(" separator="," close=")">
				'${arr_category[i]}'
			</foreach>
		</if>
		<if test="arr_area != null">
			AND local_status IN
			<foreach collection="arr_area" index="i" open="(" separator="," close=")">
				'${arr_area[i]}'
			</foreach>
		</if>
		<if test="orderValue_asc != null">
			ORDER BY ${orderType} ${orderValue_asc}
		</if>
		<if test="orderValue_desc != null">
			ORDER BY ${orderType} ${orderValue_desc}
		</if>
		<if test="orderType == null">
			ORDER BY food_store_code
		</if>
	</select>
	
	
	<!-- 맛집 랜덤 추천 -->
	<select id="randomRecommend" parameterType="HashMap" resultType="com.spring.app.trip.domain.FoodstoreVO">
		<![CDATA[
			select food_main_img, food_name
			from (
			    select food_main_img, food_name from tbl_food_store order by DBMS_RANDOM.RANDOM
			)
			where rownum <= 3
		]]> 
	</select>
	
	


</mapper>
