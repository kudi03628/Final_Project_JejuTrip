<?xml version="1.0" encoding="UTF-8"?>

<!-- ==== #29. mapper 기본설정 ==== -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- ==== #29. 루트 엘리먼트 & 네임스페이스 설정(네임스페이스명은 프로젝트 전체내에서 유일해야 한다!!!!!) ====  절대  ; 쓰지마라 !!!!!!!!!! 
메퍼가 바뀌면 무조건  WAS를 껐다 켜야한다!!!!!!!!! -->
<mapper namespace="hs_trip">



<select id="playList" resultType="com.spring.app.trip.domain.PlayVO">
	 SELECT play_code,play_category ,local_status,play_name,play_content,
       		play_mobile,play_businesshours,play_address,play_main_img,review_division
	 FROM tbl_play
	
</select>


<!-- 카테고리별 select용  -->
<select id="getPlayListByCategory" parameterType="HashMap" resultType="com.spring.app.trip.domain.PlayVO">
    select play_code, play_category, local_status, play_name, play_content, RNO,
           play_mobile, play_businesshours, play_address, play_main_img, review_division, orgFilename
    from (
        select play_code, play_category, local_status, play_name, play_content, rownum as RNO,
               play_mobile, play_businesshours, play_address, play_main_img, review_division, orgFilename
        from tbl_play
        where 1=1

 	<if test="category != null ">
        and play_category in '${category}'
    </if>
    <if test="arr_local_status != null">
			 AND local_status IN 
			<foreach collection="arr_local_status" index="i" open="(" separator="," close=")"> <!--parameter 로 들어온 map 의 key 값 , 무조건 배열만 가능  -->
				<!--              배열의                            길이만큼돌린다         (로 열고                , 로 구분짓고         ) 로 닫음      -->
				'${arr_local_status[i]}'
	 		</foreach>
	</if>
	<if test='searchWord != "" '>
		and play_name||play_content like '%'||lower('${searchWord}')||'%'
	</if>
	)
     where RNO between #{startRno} and #{endRno}
</select>


<insert id="registerPlayEnd" parameterType="com.spring.app.trip.domain.PlayVO">
insert into tbl_play( play_code, play_category, local_status, play_name, play_content, play_mobile,play_businesshours, play_address,review_division ,fileName,orgFilename,fileSize,play_main_img )
values (seq_common.nextval,#{play_category},#{local_status},#{play_name},#{play_content},#{play_mobile},#{play_businesshours},#{play_address},default,#{fileName},#{orgFilename},#{fileSize},#{fileName} )

</insert>


<select id="getPlayTotalCount" parameterType="HashMap" resultType="int">
select count(*)
from tbl_play
where 1=1
<if test="category != null ">
        and play_category in '${category}'
        </if>
    <if test="arr_local_status != null">
			 AND local_status IN 
			<foreach collection="arr_local_status" index="i" open="(" separator="," close=")"> <!--parameter 로 들어온 map 의 key 값 , 무조건 배열만 가능  -->
				<!--              배열의                            길이만큼돌린다         (로 열고                , 로 구분짓고         ) 로 닫음      -->
				'${arr_local_status[i]}'
	 		</foreach>
	</if>
	<if test='searchWord != "" '>
		and play_name||play_content like '%'||lower('${searchWord}')||'%'
	</if>
</select>


<select id="goAddSchedule" parameterType="String" resultType="com.spring.app.trip.domain.PlayVO">
	 SELECT play_code,play_category ,local_status,play_name,play_content,
       		play_mobile,play_businesshours,play_address,play_main_img,review_division
	 FROM tbl_play
	 where play_code=#{play_code}
	
</select>

<insert id="addReview" parameterType="com.spring.app.trip.domain.ReviewVO">
insert into tbl_review (review_code, fk_userid, parent_code, review_content, review_division_R )
				values (seq_review.nextval,#{fk_userid},#{parent_code},#{review_content},#{review_division_R})
</insert>
 
<select id="reviewList" parameterType="HashMap" resultType="com.spring.app.trip.domain.ReviewVO">
SELECT review_content,fk_userid,registerday,review_code,RNO
FROM
	(
		select review_content,fk_userid,registerday,review_code,rownum as RNO
		from tbl_review
		where parent_code = #{parent_code}
	)
where RNO between #{startRno} and #{endRno}

</select>


<select id="getPlayReviewCount" parameterType="HashMap" resultType="int">
select count(*)
from tbl_review
where parent_code = #{parent_code}
</select>
 
 
<update id="updateReview" parameterType="HashMap">
	update tbl_review set review_content = #{review_content} , registerday = default where review_code = #{review_code}
</update> 
 
<delete id="reviewDel" parameterType="String">
	delete from tbl_review where review_code = #{review_code}
</delete> 
 
<select id="getPlaySelect" parameterType="HashMap" resultType="com.spring.app.trip.domain.PlayVO">
SELECT play_code,play_category ,local_status,play_name,play_content,
       		play_mobile,play_businesshours,play_address,play_main_img,review_division
	 FROM tbl_play
WHERE play_code = #{play_code}	 
</select>


<update id="editEnd" parameterType="com.spring.app.trip.domain.PlayVO">
    update tbl_play
    <set>
        play_category = #{play_category},
        local_status = #{local_status},
        play_name = #{play_name},
        play_content = #{play_content},
        play_mobile = #{play_mobile},
        play_businesshours = #{play_businesshours},
        play_address = #{play_address}
        <if test="fileName != null">
            , fileName = #{fileName},
            orgFilename = #{orgFilename},
            fileSize = #{fileSize},
            play_main_img = #{fileName}
        </if>
    </set>
    where play_code = #{play_code}
</update>

 
</mapper>